#
# To profile zsh startup time:
# 1. Uncomment the zmodload line, start a shell, then 
# 2. run: zprof in ther terminal to get the profiling information
#
zmodload zsh/zprof

_ENV="$(chezmoi source-path)"

#
# IMPORTANT: Create a backup of ~/.zshrc so that if I fuck it up, I can restore from last usage
#

# If this ZSHRC is different to the one in ~/Projects/env, then copy it to that file as a backup.
# Note, we use .zshrc.backup because if we `cat ~/.zshrc` while `~/.zshrc` is executing, it returns empty.
# Also, we get an extra backup for free.
cp ~/.zshrc ~/.zshrc.backup
SHA_HOME=$(get_sha1 ~/.zshrc.backup)
SHA_DEV=$(get_sha1 $_ENV/dot_zshrc)
if [ $SHA_HOME != $SHA_DEV ] ; then
    echo "Backing up .zshrc to $_ENV/dot_zshrc"
    cat ~/.zshrc.backup > "$_ENV/dot_zshrc"
fi



#
# Starship prompt (different to Spaceship)
# https://starship.rs/
# - cross-platform
# - written in rust, really fast
#

eval "$(starship init zsh)"



# Download Znap, if it's not there yet.
[[ -f ~/Git/zsh-snap/znap.zsh ]] ||
    git clone --depth 1 -- \
        https://github.com/marlonrichert/zsh-snap.git ~/Git/zsh-snap

source ~/Git/zsh-snap/znap.zsh  # Start Znap

#
# Prompt
# Disable starship (aboce) if you try these
# `znap prompt` makes your prompt visible in just 15-40ms!
#

# znap prompt zimfw/eriner
# znap prompt robbyrussell
# znap prompt sindresorhus/pure



# `znap source` automatically downloads and starts your plugins.
znap source jscutlery/nx-completion
znap source zsh-users/zsh-completions
znap source marlonrichert/zsh-autocomplete
znap source zsh-users/zsh-autosuggestions
znap source zsh-users/zsh-syntax-highlighting



#
# yq
#

# shell completion
yq shell-completion zsh > "${fpath[1]}/_yq"



#
# terraform
#

# shell completion
complete -o nospace -C /usr/local/bin/terraform terraform


#
# git
#
znap source ohmyzsh/ohmyzsh lib/{git,theme-and-appearance}



# Disable annoying beep in shell
unsetopt BEEP

export LANG=en_US.UTF-8

# Disable 'zsh: do you wish to see all 923 possibilities (462 lines)?'
# zstyle ':completion:*' list-prompt   ''
# zstyle ':completion:*' select-prompt ''


#
# Yarn
#

export PATH="$HOME/.yarn/bin:$HOME/.config/yarn/global/node_modules/.bin:$PATH"



#
# Google Cloud
#

# The next line updates PATH for the Google Cloud SDK.
if [ -f '/Users/martaver/Projects/tools/google-cloud-sdk/path.zsh.inc' ]; then . '/Users/martaver/Projects/tools/google-cloud-sdk/path.zsh.inc'; fi

# The next line enables shell command completion for gcloud.
if [ -f '/Users/martaver/Projects/tools/google-cloud-sdk/completion.zsh.inc' ]; then . '/Users/martaver/Projects/tools/google-cloud-sdk/completion.zsh.inc'; fi



#
# Postgres
#

# Set Postgresql's data directory
export PGDATA=/usr/local/var/postgres



#
# Flutter
#
export PATH="$PATH:/Users/martaver/flutter/bin"



#
# Java
#
export PATH="/opt/homebrew/opt/openjdk/bin:$PATH"
export JAVA_HOME="/opt/homebrew/opt/openjdk/libexec/openjdk.jdk/Contents/Home"



#
# NVM
#
export NVM_DIR="$HOME/.nvm"
[ -s "/usr/local/opt/nvm/nvm.sh" ] && . "/usr/local/opt/nvm/nvm.sh"  # This loads nvm
[ -s "/usr/local/opt/nvm/etc/bash_completion.d/nvm" ] && . "/usr/local/opt/nvm/etc/bash_completion.d/nvm"  # This loads nvm bash_completion

export NVM_SYMLINK_CURRENT=true


#
# git-subrepo
#
[[ -f ~/git/git-subrepo/.rc ]] ||
    git clone --depth 1 -- \
        https://github.com/ingydotnet/git-subrepo ~/git/git-subrepo

source ~/git/git-subrepo/.rc




#
# chezmoi
#
alias -g cm="chezmoi"



#
# yabai executable functions
#

PATH="${PATH}:/Users/martaver/.yabai/bin"